<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>행운수집기 - 로또 번호 추첨 게임</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
        html,body { height:100%; }
        body{
            min-height:100vh;
            display:flex;
            align-items:flex-start;
            justify-content:center;
            background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color:#fff;
            padding:12px;
        }
        .app {
            width:100%;
            max-width:980px;
        }
        .header {
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:10px;
            margin-bottom:10px;
        }
        h1{
            font-size:clamp(18px,4vw,26px);
            margin:0;
            display:flex;
            align-items:center;
            gap:8px;
        }
        .controls-top {
            display:flex;
            gap:8px;
            align-items:center;
        }
        #volumeBtn{
            background:rgba(255,255,255,0.08);
            color:white;
            border:1px solid rgba(255,255,255,0.12);
            padding:8px 12px;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
            display:inline-flex;
            align-items:center;
            gap:8px;
        }
        #volumeBtn:active{ transform:scale(0.98); }
        .container {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(8px);
            padding:12px;
            border-radius:16px;
            box-shadow:0 8px 30px rgba(0,0,0,0.3);
        }

        #canvasWrapper {
            width:100%;
            margin:0 auto;
            display:flex;
            align-items:center;
            justify-content:center;
        }

        canvas{
            display:block;
            width:100%;
            height:auto;
            border-radius:10px;
            border:3px solid rgba(255,255,255,0.12);
            background:#121224;
            touch-action:none;
        }

        .mobile-hint{
            display:none;
            margin-top:8px;
            font-size:13px;
            text-align:center;
            opacity:0.95;
            background: rgba(255,215,0,0.12);
            color:#111;
            padding:8px;
            border-radius:8px;
        }

        .compact {
            display:flex;
            gap:8px;
            align-items:center;
            justify-content:center;
            margin-top:12px;
        }

        .share-section{
            margin-top:12px;
            padding:10px;
            border-radius:10px;
            background: rgba(255,255,255,0.03);
            display:flex;
            flex-direction:column;
            gap:8px;
            align-items:center;
        }

        .lucky-numbers{
            font-size:clamp(14px,3.5vw,18px);
            color:#FFD700;
            font-weight:700;
            text-align:center;
        }

        .share-buttons{
            display:flex;
            gap:8px;
            flex-wrap:wrap;
            justify-content:center;
        }

        .share-btn{
            padding:8px 12px;
            border-radius:8px;
            border:none;
            cursor:pointer;
            font-weight:700;
        }

        .share-btn.kakao{ background:#FEE500; color:#000; }
        .share-btn.twitter{ background:#1DA1F2; color:#fff; }
        .share-btn.facebook{ background:#1877F2; color:#fff; }
        .share-btn.copy{ background:rgba(255,255,255,0.12); color:#fff; }

        .info{
            margin-top:12px;
            padding:10px;
            border-radius:10px;
            background: rgba(0,0,0,0.12);
            color:rgba(255,255,255,0.75);
            font-size:13px;
            text-align:center;
        }

        /* 모바일에서 캔버스 최대화 & 광고/링크 축소 */
        @media (max-width:768px){
            body{ padding:6px; }
            .app{ padding:4px; }
            .info{ display:none; } /* 광고 영역 숨김 */
            .donation{ display:none; }
            .mobile-hint{ display:block; }
            .share-section{ padding:8px; font-size:13px; }
            h1{ font-size:18px; }
            #volumeBtn{ padding:8px; font-size:13px; }
            /* 캔버스가 화면에서 크게 보이도록 여백 최소화 */
            .container{ padding:8px; border-radius:10px; }
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <h1>🎮 행운수집기</h1>
            <div class="controls-top">
                <button id="volumeBtn" aria-pressed="false">🔊 볼륨 ON</button>
            </div>
        </div>

        <div class="container">
            <div id="canvasWrapper">
                <!-- 캔버스의 width/height 속성은 초기 논리 해상도 -->
                <canvas id="gameCanvas" width="600" height="400"></canvas>
            </div>

            <div class="mobile-hint">📱 화면을 터치하면 우산이 그곳으로 이동해요!</div>

            <div class="share-section" id="shareSection">
                <div class="lucky-numbers" id="luckyNumbers">번호 6개를 모두 모아주세요!</div>
                <div class="share-buttons">
                    <button class="share-btn kakao" onclick="shareGeneric('kakao')">💬 카카오톡</button>
                    <button class="share-btn twitter" onclick="shareGeneric('twitter')">🐦 트위터</button>
                    <button class="share-btn facebook" onclick="shareGeneric('facebook')">📘 페이스북</button>
                    <button class="share-btn copy" onclick="generateAndCopyShareLink()">🔗 링크 생성 및 복사</button>
                </div>
                <div style="font-size:12px; color:rgba(255,255,255,0.6); margin-top:6px;">(공유 링크를 열면 동일한 번호가 자동으로 표시됩니다.)</div>
            </div>

            <div class="info" id="adInfo">
                📢 광고 영역 — 모바일에서는 축소/숨김 처리됩니다.
            </div>
        </div>
    </div>

    <script>
    // ------------- 전역 설정 (볼륨 30% 감소 적용) -------------
    let globalVolume = 0.7; // "30% 줄여줘" => 원래 1.0 대비 0.7
    let muted = false;

    const volumeBtn = document.getElementById('volumeBtn');
    volumeBtn.addEventListener('click', () => {
        muted = !muted;
        volumeBtn.textContent = muted ? '🔇 볼륨 OFF' : '🔊 볼륨 ON';
        volumeBtn.setAttribute('aria-pressed', muted ? 'true':'false');
    });

    // ------------- 캔버스 & 사이즈 최적화 -------------
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas(){
        const wrapper = document.getElementById('canvasWrapper');
        const maxWidth = wrapper.clientWidth;
        const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);

        // 기본 종횡비 (height / width)
        const aspect = 400 / 600;

        // 모바일에서 가능한 높이를 최대 활용 (헤더/패딩 고려)
        const smallScreen = vw <= 768;
        let desiredWidth = maxWidth;
        let desiredHeight = Math.round(desiredWidth * aspect);

        if (smallScreen) {
            // 화면 세로 중 캔버스에 할당할 최대 높이: 전체 창 높이에서 약간의 UI(헤더/버튼) 공간을 뺀 값
            const reserved = 180; // header + 기타 UI 여유
            const availHeight = Math.max(120, window.innerHeight - reserved);
            // 원하는 높이는 availHeight를 넘지 않도록
            if (availHeight < desiredHeight) {
                desiredHeight = availHeight;
                desiredWidth = Math.round(desiredHeight / aspect);
            }
        }

        // style 크기(보이는 크기)
        canvas.style.width = desiredWidth + 'px';
        canvas.style.height = desiredHeight + 'px';

        // 논리 캔버스 해상도를 보이는 크기와 같게 설정하여 물리 좌표 계산이 일관되게 동작하도록 함
        canvas.width = desiredWidth;
        canvas.height = desiredHeight;

        // 슬롯 등 화면 요소 재계산
        rebuildSlots();
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // ------------- 게임 데이터 (slots는 resize에서 재생성) -------------
    const usedNumbers = new Set();
    const player = {
        x: 300, y: 200, width: 60, height: 45, speed: 5,
        hookX: 0, hookY: 0, hookRadius: 25, heldBall: null, caughtBalls: [], maxBalls: 6
    };
    let slots = [];
    let slotSize = 13;

    function rebuildSlots(){
        slots = [];
        slotSize = Math.max(10, Math.round(canvas.width * 0.02));
        const slotStartX = Math.round(canvas.width * 0.05);
        const slotStartY = Math.round(canvas.height * 0.06);
        const slotSpacing = Math.round((canvas.width - slotStartX*2) / 6);
        for (let i=0;i<6;i++){
            slots.push({
                x: slotStartX + i * slotSpacing + Math.round(slotSpacing/2),
                y: slotStartY,
                radius: slotSize + 5,
                filled:false
            });
        }

        // 만약 공유 URL로 번호가 들어왔을 경우, applySharedNumbers에서 슬롯을 채움.
        // 슬롯 위치는 이제 준비되었으니 caughtBalls의 slotIndex를 갱신
        for (let i=0;i<player.caughtBalls.length;i++){
            player.caughtBalls[i].slotIndex = i;
            player.caughtBalls[i].inSlot = true;
            slots[i].filled = true;
        }
    }

    // ------------- 공, 물리, 스폰 -------------
    const balls = [];
    const ballRadius = 10;
    const gravity = 0.5;
    const bounce = 0.6;
    let isSpawning = true;
    let cooldownTimer = 0;
    const debris = [];
    const bombZone = { x: 0, y: 10, size: 60, pulseSiz
